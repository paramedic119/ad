<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•‘æ€¥æ•‘å‘½å£« è–¬å‰¤ãƒ—ãƒ¬ãƒ†ã‚¹ãƒˆ</title>
    <style>
        :root { --primary: #007bff; --bg: #f0f4f8; }
        
        /* æ–‡å­—ã‚µã‚¤ã‚ºå®šç¾© */
        body.font-small { --q-size: 0.85rem; --line-h: 1.4; }
        body.font-medium { --q-size: 1rem; --line-h: 1.6; }
        body.font-large { --q-size: 1.25rem; --line-h: 1.8; }

        body { font-family: sans-serif; background: var(--bg); padding: 5px; margin: 0; color: #333; transition: all 0.2s; }
        .app-container { max-width: 600px; margin: auto; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .app-header { font-size: 14px; font-weight: bold; text-align: center; margin-bottom: 5px; color: #333; }

        /* æ–‡å­—ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– */
        .size-selector { display: flex; justify-content: center; gap: 2px; margin-bottom: 8px; background: #eee; border-radius: 5px; padding: 2px; }
        .size-btn { flex: 1; border: none; background: none; font-size: 11px; padding: 5px; cursor: pointer; border-radius: 4px; color: #666; }
        .size-btn.active { background: white; color: var(--primary); font-weight: bold; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

        .progress-outer { background: #eee; border-radius: 10px; height: 14px; position: relative; overflow: hidden; margin-bottom: 8px; }
        .progress-inner { background: #28a745; height: 100%; width: 0%; transition: width 0.3s; }
        .progress-text { position: absolute; width: 100%; text-align: center; font-size: 9px; line-height: 14px; font-weight: bold; }

        .setup-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; background: #f8f9fa; padding: 8px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #ddd; }
        .setup-item label { font-size: 10px; font-weight: bold; color: #666; }
        select { padding: 4px; border-radius: 4px; border: 1px solid #ccc; width: 100%; font-size: 11px; }

        .question-header { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 5px; color: var(--primary); font-weight: bold; }
        
        /* ğŸ’¡ ã“ã“ãŒã‚µã‚¤ã‚ºåˆ‡æ›¿ã®å¯¾è±¡ */
        .question-text { font-size: var(--q-size); line-height: var(--line-h); background: #fff; padding: 12px; border: 1px solid #eee; border-radius: 8px; min-height: 80px; margin-bottom: 10px; word-break: break-all; }
        
        .blank { display: inline-block; min-width: 30px; border-bottom: 1.5px solid var(--primary); text-align: center; color: transparent; background: #f0f7ff; margin: 0 1px; border-radius: 2px; }
        .blank.revealed { color: #d93025; background: transparent; border-bottom: none; font-weight: bold; }

        .btn-group { display: flex; gap: 5px; margin-bottom: 10px; }
        button { padding: 10px 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 13px; font-weight: bold; flex: 1; }
        .primary { background: var(--primary); color: white; }
        .secondary { background: #6c757d; color: white; }
        
        .nav-group { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 8px; font-size: 11px; }
        .outline { background: white; border: 1px solid var(--primary); color: var(--primary); padding: 5px 10px; flex: none; font-size: 11px; }
        .checkbox-label { display: flex; align-items: center; gap: 2px; font-size: 10px; cursor: pointer; }
    </style>
</head>
<body class="font-medium"> <div class="app-container">
    <div class="app-header">ğŸš‘ æ•‘æ€¥æ•‘å‘½å£« è–¬å‰¤ãƒ—ãƒ¬ãƒ†ã‚¹ãƒˆ</div>

    <div class="size-selector">
        <button class="size-btn" onclick="setFontSize('small', this)">æ–‡å­—:å°</button>
        <button class="size-btn active" onclick="setFontSize('medium', this)">æ–‡å­—:ä¸­</button>
        <button class="size-btn" onclick="setFontSize('large', this)">æ–‡å­—:å¤§</button>
    </div>

    <div class="progress-outer">
        <div id="progress-bar" class="progress-inner"></div>
        <div id="progress-text" class="progress-text">0/300</div>
    </div>
    
    <div class="setup-panel">
        <div class="setup-item">
            <label>ğŸ“‚ã‚«ãƒ†ã‚´ãƒª</label>
            <select id="category-filter" onchange="resetIndex()"></select>
        </div>
        <div class="setup-item">
            <label>ğŸ”„é †åº</label>
            <select id="order-mode" onchange="resetIndex()">
                <option value="sequential">ç•ªå·é †</option>
                <option value="random">ãƒ©ãƒ³ãƒ€ãƒ </option>
                <option value="weak">è‹¦æ‰‹ã®ã¿</option>
            </select>
        </div>
        <div class="setup-item">
            <label>âš¡é›£æ˜“åº¦</label>
            <select id="difficulty" onchange="loadQuiz()">
                <option value="0.3">åˆç´š</option>
                <option value="0.6" selected>ä¸­ç´š</option>
                <option value="1.0">ä¸Šç´š</option>
                <option value="super">è¶…ä¸Šç´š</option>
            </select>
        </div>
        <div class="setup-item" style="display:flex; align-items:flex-end;">
             <label class="checkbox-label"><input type="checkbox" id="number-only-filter" onchange="resetIndex()">ğŸ”¢æ•°å­—ã®ã¿</label>
        </div>
    </div>

    <div class="question-header">
        <span id="q-num">No.---</span>
        <label class="checkbox-label"><input type="checkbox" id="weak-checkbox" onchange="toggleWeak()">â­è‹¦æ‰‹</label>
    </div>

    <div id="display" class="question-text">èª­ã¿è¾¼ã¿ä¸­...</div>

    <div class="btn-group">
        <button class="secondary" onclick="revealAll()">ç­”ãˆ(A)</button>
        <button class="primary" onclick="nextQuestion()">æ¬¡ã¸(Enter)</button>
    </div>

    <div class="nav-group">
        <button class="outline" onclick="prevQuestion()">â—€å‰</button>
        <span id="counter-text">- / -</span>
        <button class="outline" onclick="nextQuestion()">æ¬¡â–¶</button>
    </div>
</div>

<script src="questions1.js"></script>
<script src="questions2.js"></script>
<script src="questions3.js"></script>
<script src="questions4.js"></script>
<script src="questions5.js"></script>
<script src="questions6.js"></script>

<script>
// æ–‡å­—ã‚µã‚¤ã‚ºå¤‰æ›´ç”¨é–¢æ•°
function setFontSize(size, btn) {
    document.body.classList.remove('font-small', 'font-medium', 'font-large');
    document.body.classList.add('font-' + size);
    
    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    // è¨­å®šã‚’ä¿å­˜
    localStorage.setItem('preferredFontSize', size);
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜ã•ã‚ŒãŸã‚µã‚¤ã‚ºã‚’é©ç”¨
const savedSize = localStorage.getItem('preferredFontSize');
if (savedSize) {
    document.body.classList.remove('font-small', 'font-medium', 'font-large');
    document.body.classList.add('font-' + savedSize);
    document.querySelectorAll('.size-btn').forEach(b => {
        if(b.innerText.includes(savedSize === 'small' ? 'å°' : savedSize === 'medium' ? 'ä¸­' : 'å¤§')) {
            b.classList.add('active');
        } else {
            b.classList.remove('active');
        }
    });
}

// --- ä»¥ä¸‹ã€æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯ ---
let allQuizData = [];
let currentIndex = 0;
let smartRandomQueue = []; 
let weakList = JSON.parse(localStorage.getItem('weakList')) || [];
let history = JSON.parse(localStorage.getItem('quizHistory')) || [];

function init() {
    try {
        allQuizData = [].concat(
            typeof quizData1 !== 'undefined' ? quizData1 : [],
            typeof quizData2 !== 'undefined' ? quizData2 : [],
            typeof quizData3 !== 'undefined' ? quizData3 : [],
            typeof quizData4 !== 'undefined' ? quizData4 : [],
            typeof quizData5 !== 'undefined' ? quizData5 : [],
            typeof quizData6 !== 'undefined' ? quizData6 : []
        );
    } catch (e) { console.error(e); }

    const categories = [...new Set(allQuizData.map(q => q.category))];
    const filter = document.getElementById('category-filter');
    filter.innerHTML = '<option value="all">ã™ã¹ã¦</option>';
    categories.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat; opt.textContent = cat;
        filter.appendChild(opt);
    });

    updateProgress();
    loadQuiz();
}

function resetIndex() {
    currentIndex = 0;
    smartRandomQueue = []; 
    loadQuiz();
}

function getActiveList() {
    const cat = document.getElementById('category-filter').value;
    const mode = document.getElementById('order-mode').value;
    const numberOnly = document.getElementById('number-only-filter').checked;
    let list = allQuizData;
    if (cat !== 'all') list = list.filter(q => q.category === cat);
    if (mode === 'weak') list = list.filter(q => weakList.includes(q.id));
    if (numberOnly) list = list.filter(q => q.targets.some(t => /[0-9ï¼-ï¼™]/.test(t)));
    return list;
}

function refreshSmartRandomQueue(length) {
    smartRandomQueue = [...Array(length).keys()].sort(() => Math.random() - 0.5);
}

function loadQuiz() {
    const activeData = getActiveList();
    const mode = document.getElementById('order-mode').value;
    const diff = document.getElementById('difficulty').value;

    if (activeData.length === 0) {
        document.getElementById('display').innerHTML = "è©²å½“ãªã—";
        document.getElementById('counter-text').textContent = "0/0";
        return;
    }

    if (mode === 'random') {
        if (smartRandomQueue.length !== activeData.length) {
            refreshSmartRandomQueue(activeData.length);
            currentIndex = 0;
        }
        var targetIndex = smartRandomQueue[currentIndex];
    } else {
        if (currentIndex >= activeData.length) currentIndex = 0;
        var targetIndex = currentIndex;
    }

    const item = activeData[targetIndex];
    if (!history.includes(item.id)) {
        history.push(item.id);
        localStorage.setItem('quizHistory', JSON.stringify(history));
        updateProgress();
    }

    document.getElementById('q-num').textContent = `[${item.category}] No.${item.id}`;
    document.getElementById('counter-text').textContent = `${currentIndex + 1}/${activeData.length}`;
    document.getElementById('weak-checkbox').checked = weakList.includes(item.id);

    let html = "";
    if (diff === "super") {
        html = item.text.replace(/([ä¸€-é¾ ]{2,}|[ã‚¡-ãƒ´ãƒ¼]+|[a-zA-Z0-9]+)/g, m => `<span class="blank" onclick="this.classList.add('revealed')">${m}</span>`);
    } else {
        let text = item.text;
        const rate = parseFloat(diff);
        const shuffled = [...item.targets].sort(() => Math.random() - 0.5);
        const finalTargets = shuffled.slice(0, Math.max(1, Math.ceil(item.targets.length * rate))).sort((a, b) => b.length - a.length);
        finalTargets.forEach(t => { text = text.split(t).join(`###${t}###`); });
        html = text.replace(/###(.*?)###/g, (m, p1) => `<span class="blank" onclick="this.classList.add('revealed')">${p1}</span>`);
    }
    document.getElementById('display').innerHTML = html;
}

function nextQuestion() {
    const activeData = getActiveList();
    if (activeData.length === 0) return;
    currentIndex++;
    if (currentIndex >= activeData.length) currentIndex = 0;
    loadQuiz();
}

function prevQuestion() {
    const activeData = getActiveList();
    if (activeData.length === 0) return;
    currentIndex = (currentIndex - 1 + activeData.length) % activeData.length;
    loadQuiz();
}

function revealAll() {
    document.querySelectorAll('.blank').forEach(el => el.classList.add('revealed'));
}

function toggleWeak() {
    const activeData = getActiveList();
    const mode = document.getElementById('order-mode').value;
    const realIdx = (mode === 'random') ? smartRandomQueue[currentIndex] : currentIndex;
    const item = activeData[realIdx];
    if (!item) return;
    if (document.getElementById('weak-checkbox').checked) {
        if (!weakList.includes(item.id)) weakList.push(item.id);
    } else {
        weakList = weakList.filter(id => id !== item.id);
    }
    localStorage.setItem('weakList', JSON.stringify(weakList));
}

function updateProgress() {
    const total = allQuizData.length;
    const completed = history.length;
    const percent = total > 0 ? Math.floor((completed / total) * 100) : 0;
    document.getElementById('progress-bar').style.width = percent + "%";
    document.getElementById('progress-text').textContent = `${completed}/${total} (${percent}%)`;
}

window.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') { e.preventDefault(); nextQuestion(); }
    if (e.key === 'a' || e.key === 'A') revealAll();
});

window.onload = init;
</script>
</body>
</html>
